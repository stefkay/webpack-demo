{"version":3,"sources":["index.js"],"names":[],"mappings":"AAAA;;;;;;;AAOA;;AAEA;;;;;AAKA,IAAI,cAAc,QAAQ,aAAR,CAAlB;AACA,IAAI,QAAQ,QAAQ,OAAR,EAAiB,MAAjB,CAAZ;AACA,IAAI,YAAY,QAAQ,MAAR,EAAgB,MAAhB,CAAhB;AACA,IAAI,UAAU,QAAQ,SAAR,CAAd;AACA,IAAI,YAAY,QAAQ,WAAR,CAAhB;AACA,IAAI,aAAa,QAAQ,aAAR,CAAjB;AACA,IAAI,OAAO,QAAQ,MAAR,CAAX;AACA,IAAI,eAAe,QAAQ,QAAR,EAAkB,YAArC;AACA,IAAI,QAAQ,QAAQ,OAAR,CAAZ;AACA,IAAI,KAAK,QAAQ,IAAR,CAAT;AACA,IAAI,OAAO,QAAQ,MAAR,CAAX;AACA,IAAI,KAAK,QAAQ,IAAR,CAAT;AACA,IAAI,aAAa,QAAQ,aAAR,CAAjB;AACA,IAAI,aAAa,QAAQ,cAAR,CAAjB;AACA,IAAI,OAAO,QAAQ,MAAR,CAAX;AACA,IAAI,WAAW,QAAQ,UAAR,CAAf;AACA,IAAI,SAAS,QAAQ,QAAR,CAAb;AACA,IAAI,OAAO,QAAQ,MAAR,CAAX;;AAEA;;;;;AAKA,IAAI,UAAU,KAAK,OAAnB;AACA,IAAI,OAAO,KAAK,IAAhB;AACA,IAAI,YAAY,KAAK,SAArB;AACA,IAAI,UAAU,KAAK,OAAnB;AACA,IAAI,MAAM,KAAK,GAAf;;AAEA;;;;;AAKA,IAAI,qBAAqB,WAAzB;;AAEA;;;;;AAKA,IAAI,aAAa,KAAK,EAAL,GAAU,EAAV,GAAe,GAAf,GAAqB,IAAtC,CAA2C;;AAE3C;;;;;AAKA,IAAI,iBAAiB,8BAArB;;AAEA;;;;;AAKA,OAAO,OAAP,GAAiB,IAAjB;AACA,OAAO,OAAP,CAAe,IAAf,GAAsB,IAAtB;;AAEA;;;;AAIA;AACA,IAAI,gBAAgB,aAAa,aAAb,IAClB,UAAU,OAAV,EAAmB,IAAnB,EAAyB;AAAE,SAAO,QAAQ,SAAR,CAAkB,IAAlB,EAAwB,MAA/B;AAAuC,CADpE;;AAGA;;;;;;;;;;AAUA,SAAS,IAAT,CAAe,GAAf,EAAoB,IAApB,EAA0B,OAA1B,EAAmC;AACjC,SAAO,IAAI,UAAJ,CAAe,GAAf,EAAoB,IAApB,EAA0B,OAA1B,CAAP;AACD;;AAED;;;;;;;;;AASA,SAAS,UAAT,CAAqB,GAArB,EAA0B,IAA1B,EAAgC,OAAhC,EAAyC;AACvC,SAAO,IAAP,CAAY,IAAZ;;AAEA,MAAI,OAAO,WAAW,EAAtB;;AAEA,OAAK,OAAL,GAAe,IAAf;AACA,OAAK,IAAL,GAAY,IAAZ;AACA,OAAK,GAAL,GAAW,GAAX;;AAEA,OAAK,aAAL,GAAqB,KAAK,YAAL,KAAsB,SAAtB,GACjB,QAAQ,KAAK,YAAb,CADiB,GAEjB,IAFJ;;AAIA,OAAK,aAAL,GAAqB,KAAK,YAAL,KAAsB,SAAtB,GACjB,QAAQ,KAAK,YAAb,CADiB,GAEjB,IAFJ;;AAIA,OAAK,KAAL,GAAa,KAAK,IAAL,KAAc,SAAd,GACT,QAAQ,KAAK,IAAb,CADS,GAET,IAFJ;;AAIA,OAAK,SAAL,GAAiB,KAAK,QAAL,KAAkB,SAAlB,GACb,KAAK,QADQ,GAEb,QAFJ;;AAIA,MAAI,KAAK,SAAL,KAAmB,QAAnB,IAA+B,KAAK,SAAL,KAAmB,OAAlD,IAA6D,KAAK,SAAL,KAAmB,MAApF,EAA4F;AAC1F,UAAM,IAAI,SAAJ,CAAc,sDAAd,CAAN;AACD;;AAED,OAAK,OAAL,GAAe,QAAQ,KAAK,MAAb,CAAf;;AAEA,MAAI,KAAK,MAAL,KAAgB,SAApB,EAA+B;AAC7B,cAAU,8BAA8B,KAAK,OAAL,GAAe,OAAf,GAAyB,QAAvD,IAAmE,YAA7E;AACD;;AAED;AACA,MAAI,KAAK,QAAL,KAAkB,SAAtB,EAAiC;AAC/B,SAAK,SAAL,GAAiB,SAAjB;AACD;;AAED,OAAK,WAAL,GAAmB,KAAK,UAAL,KAAoB,SAApB,GACf,cAAc,KAAK,UAAnB,EAA+B,mBAA/B,CADe,GAEf,EAFJ;;AAIA,OAAK,MAAL,GAAc,KAAK,KAAL,KAAe,SAAf,GACV,cAAc,KAAK,KAAnB,EAA0B,cAA1B,CADU,GAEV,CAAC,YAAD,CAFJ;;AAIA,OAAK,aAAL,GAAqB,KAAK,YAAL,KAAsB,SAAtB,GACjB,QAAQ,KAAK,YAAb,CADiB,GAEjB,IAFJ;;AAIA,OAAK,OAAL,GAAe,KAAK,MAAL,IAAe,KAAK,MAAnC;AACA,OAAK,OAAL,GAAe,OAAO,KAAK,OAAZ,KAAwB,QAAxB,GACX,GAAG,KAAK,OAAR,CADW,GAEX,OAAO,KAAK,OAAZ,CAFJ;AAGA,OAAK,OAAL,GAAe,CAAC,MAAM,KAAK,OAAX,CAAD,GACX,KAAK,GAAL,CAAS,KAAK,GAAL,CAAS,CAAT,EAAY,KAAK,OAAjB,CAAT,EAAoC,UAApC,CADW,GAEX,CAFJ;;AAIA,OAAK,KAAL,GAAa,KAAK,IAAL,GACT,QAAQ,KAAK,IAAb,CADS,GAET,IAFJ;;AAIA,MAAI,CAAC,KAAK,KAAN,IAAe,KAAK,IAAxB,EAA8B;AAC5B,SAAK,IAAL,CAAU,KAAK,IAAf;AACD;AACF;;AAED;;;;AAIA,KAAK,QAAL,CAAc,UAAd,EAA0B,MAA1B;;AAEA;;;;;;;;AAQA,WAAW,SAAX,CAAqB,IAArB,GAA4B,UAAU,QAAV,CAAmB,SAAS,IAAT,CAAe,GAAf,EAAoB;AACjE,OAAK,KAAL,GAAa,QAAQ,GAAR,CAAb;AACA,QAAM,SAAN,EAAiB,KAAK,KAAtB;AACA,SAAO,IAAP;AACD,CAJ2B,EAIzB,gCAJyB,CAA5B;;AAMA;;;;;;;;AAQA,WAAW,SAAX,CAAqB,MAArB,GAA8B,UAAU,QAAV,CAAmB,SAAS,MAAT,CAAiB,GAAjB,EAAsB;AACrE,OAAK,OAAL,GAAe,QAAQ,GAAR,CAAf;AACA,OAAK,SAAL,GAAiB,SAAjB;AACA,QAAM,WAAN,EAAmB,KAAK,OAAxB;AACA,SAAO,IAAP;AACD,CAL6B,EAK3B,kCAL2B,CAA9B;;AAOA;;;;;;;;;AASA,WAAW,SAAX,CAAqB,KAArB,GAA6B,UAAU,QAAV,CAAmB,SAAS,KAAT,CAAgB,KAAhB,EAAuB;AACrE,MAAI,QAAQ,CAAC,KAAD,GAAS,EAAT,GAAc,cAAc,KAAd,EAAqB,gBAArB,CAA1B;AACA,QAAM,UAAN,EAAkB,KAAlB;AACA,OAAK,MAAL,GAAc,KAAd;AACA,SAAO,IAAP;AACD,CAL4B,EAK1B,kCAL0B,CAA7B;;AAOA;;;;;;;;AAQA,WAAW,SAAX,CAAqB,IAArB,GAA4B,SAAS,IAAT,CAAe,IAAf,EAAqB;AAC/C,OAAK,KAAL,GAAa,QAAQ,OAAO,IAAP,CAAR,CAAb;AACA,QAAM,SAAN,EAAiB,KAAK,KAAtB;AACA,SAAO,IAAP;AACD,CAJD;;AAMA,WAAW,SAAX,CAAqB,IAArB,GAA4B,UAAU,QAAV,CAAmB,WAAW,SAAX,CAAqB,IAAxC,EAC1B,gCAD0B,CAA5B;;AAGA,WAAW,SAAX,CAAqB,IAArB,GAA4B,UAAU,QAAV,CAAmB,WAAW,SAAX,CAAqB,IAAxC,EAC1B,gCAD0B,CAA5B;;AAGA;;;;;;;;AAQA,WAAW,SAAX,CAAqB,MAArB,GAA8B,UAAU,QAAV,CAAmB,SAAS,MAAT,CAAiB,MAAjB,EAAyB;AACxE,OAAK,OAAL,GAAe,OAAO,MAAP,KAAkB,QAAlB,GACX,GAAG,MAAH,CADW,GAEX,OAAO,MAAP,CAFJ;AAGA,OAAK,OAAL,GAAe,CAAC,MAAM,KAAK,OAAX,CAAD,GACX,KAAK,GAAL,CAAS,KAAK,GAAL,CAAS,CAAT,EAAY,KAAK,OAAjB,CAAT,EAAoC,UAApC,CADW,GAEX,CAFJ;AAGA,QAAM,YAAN,EAAoB,KAAK,OAAzB;AACA,SAAO,IAAP;AACD,CAT6B,EAS3B,oCAT2B,CAA9B;;AAWA;;;;;;;;AAQA,WAAW,SAAX,CAAqB,KAArB,GAA6B,SAAS,KAAT,CAAgB,MAAhB,EAAwB,KAAxB,EAA+B;AAC1D;AACA,MAAI,cAAc,IAAd,EAAoB,OAApB,MAAiC,CAArC,EAAwC;AACtC,WAAO,KAAK,IAAL,CAAU,OAAV,EAAmB,YAAY,KAAZ,EAAmB,MAAnB,EAA2B;AACnD,cAAQ;AAD2C,KAA3B,CAAnB,CAAP;AAGD;;AAED,MAAI,MAAM,KAAK,GAAf;AACA,MAAI,MAAM,SAAS,MAAT,CAAV;;AAEA;AACA,eAAa,GAAb;;AAEA;AACA,MAAI,SAAS,MAAM,OAAnB,EAA4B;AAC1B,eAAW,GAAX,EAAgB,MAAM,OAAtB;AACD;;AAED;AACA,MAAI,UAAJ,GAAiB,MAAjB;AACA,MAAI,SAAJ,CAAc,cAAd,EAA8B,2BAA9B;AACA,MAAI,SAAJ,CAAc,gBAAd,EAAgC,OAAO,UAAP,CAAkB,GAAlB,CAAhC;AACA,MAAI,SAAJ,CAAc,wBAAd,EAAwC,SAAxC;AACA,MAAI,GAAJ,CAAQ,GAAR;AACD,CAzBD;;AA2BA;;;;;;;AAOA,WAAW,SAAX,CAAqB,gBAArB,GAAwC,SAAS,gBAAT,GAA6B;AACnE,SAAO,KAAK,IAAL,CAAU,KAAK,IAAL,CAAU,MAAV,GAAmB,CAA7B,MAAoC,GAA3C;AACD,CAFD;;AAIA;;;;;;;AAOA,WAAW,SAAX,CAAqB,gBAArB,GAAwC,SAAS,gBAAT,GAA6B;AACnE,SAAO,KAAK,GAAL,CAAS,OAAT,CAAiB,eAAjB,KACL,KAAK,GAAL,CAAS,OAAT,CAAiB,mBAAjB,CADF;AAED,CAHD;;AAKA;;;;;;AAMA,WAAW,SAAX,CAAqB,yBAArB,GAAiD,SAAS,yBAAT,GAAsC;AACrF,MAAI,MAAM,KAAK,GAAf;AACA,MAAI,UAAU,OAAO,IAAP,CAAY,IAAI,QAAJ,IAAgB,EAA5B,CAAd;;AAEA,OAAK,IAAI,IAAI,CAAb,EAAgB,IAAI,QAAQ,MAA5B,EAAoC,GAApC,EAAyC;AACvC,QAAI,SAAS,QAAQ,CAAR,CAAb;AACA,QAAI,OAAO,MAAP,CAAc,CAAd,EAAiB,CAAjB,MAAwB,UAAxB,IAAsC,WAAW,kBAArD,EAAyE;AACvE,UAAI,YAAJ,CAAiB,MAAjB;AACD;AACF;AACF,CAVD;;AAYA;;;;;;AAMA,WAAW,SAAX,CAAqB,WAArB,GAAmC,SAAS,WAAT,GAAwB;AACzD,MAAI,MAAM,KAAK,GAAf;AACA,QAAM,cAAN;AACA,OAAK,yBAAL;AACA,MAAI,UAAJ,GAAiB,GAAjB;AACA,MAAI,GAAJ;AACD,CAND;;AAQA;;;;;;AAMA,WAAW,SAAX,CAAqB,kBAArB,GAA0C,SAAS,kBAAT,GAA+B;AACvE,MAAI,MAAM,IAAI,KAAJ,CAAU,yCAAV,CAAV;AACA,QAAM,sBAAN;AACA,OAAK,KAAL,CAAW,GAAX,EAAgB,GAAhB;AACD,CAJD;;AAMA;;;;;;;;AAQA,WAAW,SAAX,CAAqB,UAArB,GAAkC,SAAS,UAAT,GAAuB;AACvD,MAAI,aAAa,KAAK,GAAL,CAAS,UAA1B;AACA,SAAQ,cAAc,GAAd,IAAqB,aAAa,GAAnC,IACL,eAAe,GADjB;AAED,CAJD;;AAMA;;;;;;;AAOA,WAAW,SAAX,CAAqB,WAArB,GAAmC,SAAS,WAAT,CAAsB,KAAtB,EAA6B;AAC9D,UAAQ,MAAM,IAAd;AACE,SAAK,cAAL;AACA,SAAK,QAAL;AACA,SAAK,SAAL;AACE,WAAK,KAAL,CAAW,GAAX,EAAgB,KAAhB;AACA;AACF;AACE,WAAK,KAAL,CAAW,GAAX,EAAgB,KAAhB;AACA;AARJ;AAUD,CAXD;;AAaA;;;;;;;AAOA,WAAW,SAAX,CAAqB,OAArB,GAA+B,SAAS,OAAT,GAAoB;AACjD,SAAO,MAAM,KAAK,GAAL,CAAS,OAAf,EAAwB,KAAK,GAAL,CAAS,QAAjC,CAAP;AACD,CAFD;;AAIA;;;;;;;AAOA,WAAW,SAAX,CAAqB,YAArB,GAAoC,SAAS,YAAT,GAAyB;AAC3D,MAAI,UAAU,KAAK,GAAL,CAAS,OAAT,CAAiB,UAAjB,CAAd;;AAEA,MAAI,CAAC,OAAL,EAAc;AACZ,WAAO,IAAP;AACD;;AAED,SAAO,CAAC,QAAQ,OAAR,CAAgB,GAAhB,CAAD,GACH,CAAC,QAAQ,OAAR,CAAgB,KAAK,GAAL,CAAS,QAAT,CAAkB,MAAlB,CAAhB,CADE,GAEH,KAAK,KAAL,CAAW,KAAK,GAAL,CAAS,QAAT,CAAkB,eAAlB,CAAX,KAAkD,KAAK,KAAL,CAAW,OAAX,CAFtD;AAGD,CAVD;;AAYA;;;;;;;AAOA,WAAW,SAAX,CAAqB,QAArB,GAAgC,SAAS,QAAT,CAAmB,IAAnB,EAAyB;AACvD,MAAI,cAAc,IAAd,EAAoB,WAApB,MAAqC,CAAzC,EAA4C;AAC1C,SAAK,IAAL,CAAU,WAAV;AACA;AACD;;AAED,MAAI,KAAK,gBAAL,EAAJ,EAA6B;AAC3B,SAAK,KAAL,CAAW,GAAX;AACA;AACD;;AAED,MAAI,MAAM,UAAU,uBAAuB,OAAO,GAA9B,CAAV,CAAV;AACA,MAAI,MAAM,6BAA6B,WAAW,GAAX,CAA7B,GAA+C,IAA/C,GAAsD,WAAW,GAAX,CAAtD,GAAwE,QAAlF;AACA,MAAI,MAAM,KAAK,GAAf;;AAEA;AACA,MAAI,UAAJ,GAAiB,GAAjB;AACA,MAAI,SAAJ,CAAc,cAAd,EAA8B,0BAA9B;AACA,MAAI,SAAJ,CAAc,gBAAd,EAAgC,OAAO,UAAP,CAAkB,GAAlB,CAAhC;AACA,MAAI,SAAJ,CAAc,wBAAd,EAAwC,SAAxC;AACA,MAAI,SAAJ,CAAc,UAAd,EAA0B,GAA1B;AACA,MAAI,GAAJ,CAAQ,GAAR;AACD,CAtBD;;AAwBA;;;;;;;;AAQA,WAAW,SAAX,CAAqB,IAArB,GAA4B,SAAS,IAAT,CAAe,GAAf,EAAoB;AAC9C;AACA,MAAI,OAAO,KAAK,KAAhB;;AAEA;AACA,OAAK,GAAL,GAAW,GAAX;;AAEA;AACA,MAAI,OAAO,OAAO,KAAK,IAAZ,CAAX;AACA,MAAI,SAAS,CAAC,CAAd,EAAiB;AACf,SAAK,KAAL,CAAW,GAAX;AACA,WAAO,GAAP;AACD;;AAED;AACA,MAAI,CAAC,KAAK,OAAL,CAAa,IAAb,CAAL,EAAyB;AACvB,SAAK,KAAL,CAAW,GAAX;AACA,WAAO,GAAP;AACD;;AAED,MAAI,KAAJ;AACA,MAAI,SAAS,IAAb,EAAmB;AACjB;AACA,QAAI,eAAe,IAAf,CAAoB,UAAU,MAAM,GAAN,GAAY,IAAtB,CAApB,CAAJ,EAAsD;AACpD,YAAM,qBAAN,EAA6B,IAA7B;AACA,WAAK,KAAL,CAAW,GAAX;AACA,aAAO,GAAP;AACD;;AAED;AACA,WAAO,UAAU,KAAK,IAAL,EAAW,IAAX,CAAV,CAAP;AACA,WAAO,UAAU,OAAO,GAAjB,CAAP;;AAEA;AACA,YAAQ,KAAK,MAAL,CAAY,KAAK,MAAjB,EAAyB,KAAzB,CAA+B,GAA/B,CAAR;AACD,GAdD,MAcO;AACL;AACA,QAAI,eAAe,IAAf,CAAoB,IAApB,CAAJ,EAA+B;AAC7B,YAAM,qBAAN,EAA6B,IAA7B;AACA,WAAK,KAAL,CAAW,GAAX;AACA,aAAO,GAAP;AACD;;AAED;AACA,YAAQ,UAAU,IAAV,EAAgB,KAAhB,CAAsB,GAAtB,CAAR;;AAEA;AACA,WAAO,QAAQ,IAAR,CAAP;AACD;;AAED;AACA,MAAI,gBAAgB,KAAhB,CAAJ,EAA4B;AAC1B,QAAI,SAAS,KAAK,SAAlB;;AAEA;AACA,QAAI,WAAW,SAAf,EAA0B;AACxB,eAAS,MAAM,MAAM,MAAN,GAAe,CAArB,EAAwB,CAAxB,MAA+B,GAA/B,GACJ,KAAK,OAAL,GAAe,OAAf,GAAyB,QADrB,GAEL,OAFJ;AAGD;;AAED,UAAM,iBAAN,EAAyB,MAAzB,EAAiC,IAAjC;AACA,YAAQ,MAAR;AACE,WAAK,OAAL;AACE;AACF,WAAK,MAAL;AACE,aAAK,KAAL,CAAW,GAAX;AACA,eAAO,GAAP;AACF,WAAK,QAAL;AACA;AACE,aAAK,KAAL,CAAW,GAAX;AACA,eAAO,GAAP;AATJ;AAWD;;AAED;AACA,MAAI,KAAK,MAAL,CAAY,MAAZ,IAAsB,KAAK,IAAL,CAAU,KAAK,IAAL,CAAU,MAAV,GAAmB,CAA7B,MAAoC,GAA9D,EAAmE;AACjE,SAAK,SAAL,CAAe,IAAf;AACA,WAAO,GAAP;AACD;;AAED,OAAK,QAAL,CAAc,IAAd;AACA,SAAO,GAAP;AACD,CAnFD;;AAqFA;;;;;;;AAOA,WAAW,SAAX,CAAqB,IAArB,GAA4B,SAAS,IAAT,CAAe,IAAf,EAAqB,IAArB,EAA2B;AACrD,MAAI,MAAM,KAAK,IAAf;AACA,MAAI,UAAU,KAAK,OAAnB;AACA,MAAI,OAAO,EAAX;AACA,MAAI,MAAM,KAAK,GAAf;AACA,MAAI,MAAM,KAAK,GAAf;AACA,MAAI,SAAS,IAAI,OAAJ,CAAY,KAAzB;AACA,MAAI,SAAS,QAAQ,KAAR,IAAiB,CAA9B;;AAEA,MAAI,IAAI,OAAR,EAAiB;AACf;AACA,SAAK,kBAAL;AACA;AACD;;AAED,QAAM,WAAN,EAAmB,IAAnB;;AAEA;AACA,OAAK,SAAL,CAAe,IAAf,EAAqB,IAArB;;AAEA;AACA,OAAK,IAAL,CAAU,IAAV;;AAEA;AACA,MAAI,KAAK,gBAAL,MAA2B,KAAK,UAAL,EAA3B,IAAgD,KAAK,OAAL,EAApD,EAAoE;AAClE,SAAK,WAAL;AACA;AACD;;AAED;AACA,QAAM,KAAK,GAAL,CAAS,CAAT,EAAY,MAAM,MAAlB,CAAN;AACA,MAAI,QAAQ,GAAR,KAAgB,SAApB,EAA+B;AAC7B,QAAI,QAAQ,QAAQ,GAAR,GAAc,MAAd,GAAuB,CAAnC;AACA,QAAI,MAAM,KAAV,EAAiB,MAAM,KAAN;AAClB;;AAED;AACA,MAAI,KAAK,aAAL,IAAsB,mBAAmB,IAAnB,CAAwB,MAAxB,CAA1B,EAA2D;AACzD;AACA,aAAS,WAAW,GAAX,EAAgB,MAAhB,EAAwB;AAC/B,eAAS;AADsB,KAAxB,CAAT;;AAIA;AACA,QAAI,CAAC,KAAK,YAAL,EAAL,EAA0B;AACxB,YAAM,aAAN;AACA,eAAS,CAAC,CAAV;AACD;;AAED;AACA,QAAI,WAAW,CAAC,CAAhB,EAAmB;AACjB,YAAM,qBAAN;;AAEA;AACA,UAAI,SAAJ,CAAc,eAAd,EAA+B,aAAa,OAAb,EAAsB,GAAtB,CAA/B;;AAEA;AACA,aAAO,KAAK,KAAL,CAAW,GAAX,EAAgB;AACrB,iBAAS,EAAC,iBAAiB,IAAI,SAAJ,CAAc,eAAd,CAAlB;AADY,OAAhB,CAAP;AAGD;;AAED;AACA,QAAI,WAAW,CAAC,CAAZ,IAAiB,OAAO,MAAP,KAAkB,CAAvC,EAA0C;AACxC,YAAM,UAAN,EAAkB,MAAlB;;AAEA;AACA,UAAI,UAAJ,GAAiB,GAAjB;AACA,UAAI,SAAJ,CAAc,eAAd,EAA+B,aAAa,OAAb,EAAsB,GAAtB,EAA2B,OAAO,CAAP,CAA3B,CAA/B;;AAEA;AACA,gBAAU,OAAO,CAAP,EAAU,KAApB;AACA,YAAM,OAAO,CAAP,EAAU,GAAV,GAAgB,OAAO,CAAP,EAAU,KAA1B,GAAkC,CAAxC;AACD;AACF;;AAED;AACA,OAAK,IAAI,IAAT,IAAiB,OAAjB,EAA0B;AACxB,SAAK,IAAL,IAAa,QAAQ,IAAR,CAAb;AACD;;AAED;AACA,OAAK,KAAL,GAAa,MAAb;AACA,OAAK,GAAL,GAAW,KAAK,GAAL,CAAS,MAAT,EAAiB,SAAS,GAAT,GAAe,CAAhC,CAAX;;AAEA;AACA,MAAI,SAAJ,CAAc,gBAAd,EAAgC,GAAhC;;AAEA;AACA,MAAI,IAAI,MAAJ,KAAe,MAAnB,EAA2B;AACzB,QAAI,GAAJ;AACA;AACD;;AAED,OAAK,MAAL,CAAY,IAAZ,EAAkB,IAAlB;AACD,CA/FD;;AAiGA;;;;;;AAMA,WAAW,SAAX,CAAqB,QAArB,GAAgC,SAAS,QAAT,CAAmB,IAAnB,EAAyB;AACvD,MAAI,IAAI,CAAR;AACA,MAAI,OAAO,IAAX;;AAEA,QAAM,WAAN,EAAmB,IAAnB;AACA,KAAG,IAAH,CAAQ,IAAR,EAAc,SAAS,MAAT,CAAiB,GAAjB,EAAsB,IAAtB,EAA4B;AACxC,QAAI,OAAO,IAAI,IAAJ,KAAa,QAApB,IAAgC,CAAC,QAAQ,IAAR,CAAjC,IAAkD,KAAK,KAAK,MAAL,GAAc,CAAnB,MAA0B,GAAhF,EAAqF;AACnF;AACA,aAAO,KAAK,GAAL,CAAP;AACD;AACD,QAAI,GAAJ,EAAS,OAAO,KAAK,WAAL,CAAiB,GAAjB,CAAP;AACT,QAAI,KAAK,WAAL,EAAJ,EAAwB,OAAO,KAAK,QAAL,CAAc,KAAK,IAAnB,CAAP;AACxB,SAAK,IAAL,CAAU,MAAV,EAAkB,IAAlB,EAAwB,IAAxB;AACA,SAAK,IAAL,CAAU,IAAV,EAAgB,IAAhB;AACD,GATD;;AAWA,WAAS,IAAT,CAAe,GAAf,EAAoB;AAClB,QAAI,KAAK,WAAL,CAAiB,MAAjB,IAA2B,CAA/B,EAAkC;AAChC,aAAO,MACH,KAAK,WAAL,CAAiB,GAAjB,CADG,GAEH,KAAK,KAAL,CAAW,GAAX,CAFJ;AAGD;;AAED,QAAI,IAAI,OAAO,GAAP,GAAa,KAAK,WAAL,CAAiB,GAAjB,CAArB;;AAEA,UAAM,WAAN,EAAmB,CAAnB;AACA,OAAG,IAAH,CAAQ,CAAR,EAAW,UAAU,GAAV,EAAe,IAAf,EAAqB;AAC9B,UAAI,GAAJ,EAAS,OAAO,KAAK,GAAL,CAAP;AACT,UAAI,KAAK,WAAL,EAAJ,EAAwB,OAAO,MAAP;AACxB,WAAK,IAAL,CAAU,MAAV,EAAkB,CAAlB,EAAqB,IAArB;AACA,WAAK,IAAL,CAAU,CAAV,EAAa,IAAb;AACD,KALD;AAMD;AACF,CAjCD;;AAmCA;;;;;;AAMA,WAAW,SAAX,CAAqB,SAArB,GAAiC,SAAS,SAAT,CAAoB,IAApB,EAA0B;AACzD,MAAI,IAAI,CAAC,CAAT;AACA,MAAI,OAAO,IAAX;;AAEA,WAAS,IAAT,CAAe,GAAf,EAAoB;AAClB,QAAI,EAAE,CAAF,IAAO,KAAK,MAAL,CAAY,MAAvB,EAA+B;AAC7B,UAAI,GAAJ,EAAS,OAAO,KAAK,WAAL,CAAiB,GAAjB,CAAP;AACT,aAAO,KAAK,KAAL,CAAW,GAAX,CAAP;AACD;;AAED,QAAI,IAAI,KAAK,IAAL,EAAW,KAAK,MAAL,CAAY,CAAZ,CAAX,CAAR;;AAEA,UAAM,WAAN,EAAmB,CAAnB;AACA,OAAG,IAAH,CAAQ,CAAR,EAAW,UAAU,GAAV,EAAe,IAAf,EAAqB;AAC9B,UAAI,GAAJ,EAAS,OAAO,KAAK,GAAL,CAAP;AACT,UAAI,KAAK,WAAL,EAAJ,EAAwB,OAAO,MAAP;AACxB,WAAK,IAAL,CAAU,MAAV,EAAkB,CAAlB,EAAqB,IAArB;AACA,WAAK,IAAL,CAAU,CAAV,EAAa,IAAb;AACD,KALD;AAMD;;AAED;AACD,CAtBD;;AAwBA;;;;;;;;AAQA,WAAW,SAAX,CAAqB,MAArB,GAA8B,SAAS,MAAT,CAAiB,IAAjB,EAAuB,OAAvB,EAAgC;AAC5D;AACA,MAAI,WAAW,KAAf;AACA,MAAI,OAAO,IAAX;AACA,MAAI,MAAM,KAAK,GAAf;;AAEA;AACA,MAAI,SAAS,GAAG,gBAAH,CAAoB,IAApB,EAA0B,OAA1B,CAAb;AACA,OAAK,IAAL,CAAU,QAAV,EAAoB,MAApB;AACA,SAAO,IAAP,CAAY,GAAZ;;AAEA;AACA,aAAW,GAAX,EAAgB,SAAS,UAAT,GAAuB;AACrC,eAAW,IAAX;AACA,YAAQ,MAAR;AACD,GAHD;;AAKA;AACA,SAAO,EAAP,CAAU,OAAV,EAAmB,SAAS,OAAT,CAAkB,GAAlB,EAAuB;AACxC;AACA,QAAI,QAAJ,EAAc;;AAEd;AACA,eAAW,IAAX;AACA,YAAQ,MAAR;;AAEA;AACA,SAAK,WAAL,CAAiB,GAAjB;AACD,GAVD;;AAYA;AACA,SAAO,EAAP,CAAU,KAAV,EAAiB,SAAS,KAAT,GAAkB;AACjC,SAAK,IAAL,CAAU,KAAV;AACD,GAFD;AAGD,CAlCD;;AAoCA;;;;;;;;AAQA,WAAW,SAAX,CAAqB,IAArB,GAA4B,SAAS,IAAT,CAAe,IAAf,EAAqB;AAC/C,MAAI,MAAM,KAAK,GAAf;;AAEA,MAAI,IAAI,SAAJ,CAAc,cAAd,CAAJ,EAAmC;;AAEnC,MAAI,OAAO,KAAK,MAAL,CAAY,IAAZ,CAAX;;AAEA,MAAI,CAAC,IAAL,EAAW;AACT,UAAM,iBAAN;AACA;AACD;;AAED,MAAI,UAAU,KAAK,QAAL,CAAc,MAAd,CAAqB,IAArB,CAAd;;AAEA,QAAM,iBAAN,EAAyB,IAAzB;AACA,MAAI,SAAJ,CAAc,cAAd,EAA8B,QAAQ,UAAU,eAAe,OAAzB,GAAmC,EAA3C,CAA9B;AACD,CAhBD;;AAkBA;;;;;;;;;AASA,WAAW,SAAX,CAAqB,SAArB,GAAiC,SAAS,SAAT,CAAoB,IAApB,EAA0B,IAA1B,EAAgC;AAC/D,MAAI,MAAM,KAAK,GAAf;;AAEA,OAAK,IAAL,CAAU,SAAV,EAAqB,GAArB,EAA0B,IAA1B,EAAgC,IAAhC;;AAEA,MAAI,KAAK,aAAL,IAAsB,CAAC,IAAI,SAAJ,CAAc,eAAd,CAA3B,EAA2D;AACzD,UAAM,eAAN;AACA,QAAI,SAAJ,CAAc,eAAd,EAA+B,OAA/B;AACD;;AAED,MAAI,KAAK,aAAL,IAAsB,CAAC,IAAI,SAAJ,CAAc,eAAd,CAA3B,EAA2D;AACzD,QAAI,eAAe,qBAAqB,KAAK,KAAL,CAAW,KAAK,OAAL,GAAe,IAA1B,CAAxC;AACA,UAAM,kBAAN,EAA0B,YAA1B;AACA,QAAI,SAAJ,CAAc,eAAd,EAA+B,YAA/B;AACD;;AAED,MAAI,KAAK,aAAL,IAAsB,CAAC,IAAI,SAAJ,CAAc,eAAd,CAA3B,EAA2D;AACzD,QAAI,WAAW,KAAK,KAAL,CAAW,WAAX,EAAf;AACA,UAAM,aAAN,EAAqB,QAArB;AACA,QAAI,SAAJ,CAAc,eAAd,EAA+B,QAA/B;AACD;;AAED,MAAI,KAAK,KAAL,IAAc,CAAC,IAAI,SAAJ,CAAc,MAAd,CAAnB,EAA0C;AACxC,QAAI,MAAM,KAAK,IAAL,CAAV;AACA,UAAM,SAAN,EAAiB,GAAjB;AACA,QAAI,SAAJ,CAAc,MAAd,EAAsB,GAAtB;AACD;AACF,CA3BD;;AA6BA;;;;;;;AAOA,SAAS,YAAT,CAAuB,GAAvB,EAA4B;AAC1B,MAAI,QAAJ,GAAe,EAAf;AACA,MAAI,YAAJ,GAAmB,EAAnB;AACD;;AAED;;;;;;AAMA,SAAS,sBAAT,CAAiC,GAAjC,EAAsC;AACpC,OAAK,IAAI,IAAI,CAAb,EAAgB,IAAI,IAAI,MAAxB,EAAgC,GAAhC,EAAqC;AACnC,QAAI,IAAI,CAAJ,MAAW,GAAf,EAAoB;AAClB;AACD;AACF;;AAED,SAAO,IAAI,CAAJ,GACH,MAAM,IAAI,MAAJ,CAAW,CAAX,CADH,GAEH,GAFJ;AAGD;;AAED;;;;;;AAMA,SAAS,eAAT,CAA0B,KAA1B,EAAiC;AAC/B,OAAK,IAAI,IAAI,CAAb,EAAgB,IAAI,MAAM,MAA1B,EAAkC,GAAlC,EAAuC;AACrC,QAAI,MAAM,CAAN,EAAS,CAAT,MAAgB,GAApB,EAAyB;AACvB,aAAO,IAAP;AACD;AACF;;AAED,SAAO,KAAP;AACD;;AAED;;;;;;;;AAQA,SAAS,YAAT,CAAuB,IAAvB,EAA6B,IAA7B,EAAmC,KAAnC,EAA0C;AACxC,SAAO,OAAO,GAAP,IAAc,QAAQ,MAAM,KAAN,GAAc,GAAd,GAAoB,MAAM,GAAlC,GAAwC,GAAtD,IAA6D,GAA7D,GAAmE,IAA1E;AACD;;AAED;;;;;;;;;;AAUA,SAAS,MAAT,CAAiB,IAAjB,EAAuB;AACrB,MAAI;AACF,WAAO,mBAAmB,IAAnB,CAAP;AACD,GAFD,CAEE,OAAO,GAAP,EAAY;AACZ,WAAO,CAAC,CAAR;AACD;AACF;;AAED;;;;;;;;AAQA,SAAS,aAAT,CAAwB,GAAxB,EAA6B,IAA7B,EAAmC;AACjC,MAAI,OAAO,GAAG,MAAH,CAAU,OAAO,EAAjB,CAAX;;AAEA,OAAK,IAAI,IAAI,CAAb,EAAgB,IAAI,KAAK,MAAzB,EAAiC,GAAjC,EAAsC;AACpC,QAAI,OAAO,KAAK,CAAL,CAAP,KAAmB,QAAvB,EAAiC;AAC/B,YAAM,IAAI,SAAJ,CAAc,OAAO,oCAArB,CAAN;AACD;AACF;;AAED,SAAO,IAAP;AACD;;AAED;;;;;;;;AAQA,SAAS,UAAT,CAAqB,GAArB,EAA0B,OAA1B,EAAmC;AACjC,MAAI,OAAO,OAAO,IAAP,CAAY,OAAZ,CAAX;;AAEA,OAAK,IAAI,IAAI,CAAb,EAAgB,IAAI,KAAK,MAAzB,EAAiC,GAAjC,EAAsC;AACpC,QAAI,MAAM,KAAK,CAAL,CAAV;AACA,QAAI,SAAJ,CAAc,GAAd,EAAmB,QAAQ,GAAR,CAAnB;AACD;AACF","file":"index-compiled.js","sourcesContent":["/*!\n * send\n * Copyright(c) 2012 TJ Holowaychuk\n * Copyright(c) 2014-2016 Douglas Christopher Wilson\n * MIT Licensed\n */\n\n'use strict'\n\n/**\n * Module dependencies.\n * @private\n */\n\nvar createError = require('http-errors')\nvar debug = require('debug')('send')\nvar deprecate = require('depd')('send')\nvar destroy = require('destroy')\nvar encodeUrl = require('encodeurl')\nvar escapeHtml = require('escape-html')\nvar etag = require('etag')\nvar EventEmitter = require('events').EventEmitter\nvar fresh = require('fresh')\nvar fs = require('fs')\nvar mime = require('mime')\nvar ms = require('ms')\nvar onFinished = require('on-finished')\nvar parseRange = require('range-parser')\nvar path = require('path')\nvar statuses = require('statuses')\nvar Stream = require('stream')\nvar util = require('util')\n\n/**\n * Path function references.\n * @private\n */\n\nvar extname = path.extname\nvar join = path.join\nvar normalize = path.normalize\nvar resolve = path.resolve\nvar sep = path.sep\n\n/**\n * Regular expression for identifying a bytes Range header.\n * @private\n */\n\nvar BYTES_RANGE_REGEXP = /^ *bytes=/\n\n/**\n * Maximum value allowed for the max age.\n * @private\n */\n\nvar MAX_MAXAGE = 60 * 60 * 24 * 365 * 1000 // 1 year\n\n/**\n * Regular expression to match a path with a directory up component.\n * @private\n */\n\nvar UP_PATH_REGEXP = /(?:^|[\\\\\\/])\\.\\.(?:[\\\\\\/]|$)/\n\n/**\n * Module exports.\n * @public\n */\n\nmodule.exports = send\nmodule.exports.mime = mime\n\n/**\n * Shim EventEmitter.listenerCount for node.js < 0.10\n */\n\n/* istanbul ignore next */\nvar listenerCount = EventEmitter.listenerCount ||\n  function (emitter, type) { return emitter.listeners(type).length }\n\n/**\n * Return a `SendStream` for `req` and `path`.\n *\n * @param {object} req\n * @param {string} path\n * @param {object} [options]\n * @return {SendStream}\n * @public\n */\n\nfunction send (req, path, options) {\n  return new SendStream(req, path, options)\n}\n\n/**\n * Initialize a `SendStream` with the given `path`.\n *\n * @param {Request} req\n * @param {String} path\n * @param {object} [options]\n * @private\n */\n\nfunction SendStream (req, path, options) {\n  Stream.call(this)\n\n  var opts = options || {}\n\n  this.options = opts\n  this.path = path\n  this.req = req\n\n  this._acceptRanges = opts.acceptRanges !== undefined\n    ? Boolean(opts.acceptRanges)\n    : true\n\n  this._cacheControl = opts.cacheControl !== undefined\n    ? Boolean(opts.cacheControl)\n    : true\n\n  this._etag = opts.etag !== undefined\n    ? Boolean(opts.etag)\n    : true\n\n  this._dotfiles = opts.dotfiles !== undefined\n    ? opts.dotfiles\n    : 'ignore'\n\n  if (this._dotfiles !== 'ignore' && this._dotfiles !== 'allow' && this._dotfiles !== 'deny') {\n    throw new TypeError('dotfiles option must be \"allow\", \"deny\", or \"ignore\"')\n  }\n\n  this._hidden = Boolean(opts.hidden)\n\n  if (opts.hidden !== undefined) {\n    deprecate('hidden: use dotfiles: \\'' + (this._hidden ? 'allow' : 'ignore') + '\\' instead')\n  }\n\n  // legacy support\n  if (opts.dotfiles === undefined) {\n    this._dotfiles = undefined\n  }\n\n  this._extensions = opts.extensions !== undefined\n    ? normalizeList(opts.extensions, 'extensions option')\n    : []\n\n  this._index = opts.index !== undefined\n    ? normalizeList(opts.index, 'index option')\n    : ['index.html']\n\n  this._lastModified = opts.lastModified !== undefined\n    ? Boolean(opts.lastModified)\n    : true\n\n  this._maxage = opts.maxAge || opts.maxage\n  this._maxage = typeof this._maxage === 'string'\n    ? ms(this._maxage)\n    : Number(this._maxage)\n  this._maxage = !isNaN(this._maxage)\n    ? Math.min(Math.max(0, this._maxage), MAX_MAXAGE)\n    : 0\n\n  this._root = opts.root\n    ? resolve(opts.root)\n    : null\n\n  if (!this._root && opts.from) {\n    this.from(opts.from)\n  }\n}\n\n/**\n * Inherits from `Stream`.\n */\n\nutil.inherits(SendStream, Stream)\n\n/**\n * Enable or disable etag generation.\n *\n * @param {Boolean} val\n * @return {SendStream}\n * @api public\n */\n\nSendStream.prototype.etag = deprecate.function(function etag (val) {\n  this._etag = Boolean(val)\n  debug('etag %s', this._etag)\n  return this\n}, 'send.etag: pass etag as option')\n\n/**\n * Enable or disable \"hidden\" (dot) files.\n *\n * @param {Boolean} path\n * @return {SendStream}\n * @api public\n */\n\nSendStream.prototype.hidden = deprecate.function(function hidden (val) {\n  this._hidden = Boolean(val)\n  this._dotfiles = undefined\n  debug('hidden %s', this._hidden)\n  return this\n}, 'send.hidden: use dotfiles option')\n\n/**\n * Set index `paths`, set to a falsy\n * value to disable index support.\n *\n * @param {String|Boolean|Array} paths\n * @return {SendStream}\n * @api public\n */\n\nSendStream.prototype.index = deprecate.function(function index (paths) {\n  var index = !paths ? [] : normalizeList(paths, 'paths argument')\n  debug('index %o', paths)\n  this._index = index\n  return this\n}, 'send.index: pass index as option')\n\n/**\n * Set root `path`.\n *\n * @param {String} path\n * @return {SendStream}\n * @api public\n */\n\nSendStream.prototype.root = function root (path) {\n  this._root = resolve(String(path))\n  debug('root %s', this._root)\n  return this\n}\n\nSendStream.prototype.from = deprecate.function(SendStream.prototype.root,\n  'send.from: pass root as option')\n\nSendStream.prototype.root = deprecate.function(SendStream.prototype.root,\n  'send.root: pass root as option')\n\n/**\n * Set max-age to `maxAge`.\n *\n * @param {Number} maxAge\n * @return {SendStream}\n * @api public\n */\n\nSendStream.prototype.maxage = deprecate.function(function maxage (maxAge) {\n  this._maxage = typeof maxAge === 'string'\n    ? ms(maxAge)\n    : Number(maxAge)\n  this._maxage = !isNaN(this._maxage)\n    ? Math.min(Math.max(0, this._maxage), MAX_MAXAGE)\n    : 0\n  debug('max-age %d', this._maxage)\n  return this\n}, 'send.maxage: pass maxAge as option')\n\n/**\n * Emit error with `status`.\n *\n * @param {number} status\n * @param {Error} [error]\n * @private\n */\n\nSendStream.prototype.error = function error (status, error) {\n  // emit if listeners instead of responding\n  if (listenerCount(this, 'error') !== 0) {\n    return this.emit('error', createError(error, status, {\n      expose: false\n    }))\n  }\n\n  var res = this.res\n  var msg = statuses[status]\n\n  // clear existing headers\n  clearHeaders(res)\n\n  // add error headers\n  if (error && error.headers) {\n    setHeaders(res, error.headers)\n  }\n\n  // send basic response\n  res.statusCode = status\n  res.setHeader('Content-Type', 'text/plain; charset=UTF-8')\n  res.setHeader('Content-Length', Buffer.byteLength(msg))\n  res.setHeader('X-Content-Type-Options', 'nosniff')\n  res.end(msg)\n}\n\n/**\n * Check if the pathname ends with \"/\".\n *\n * @return {Boolean}\n * @api private\n */\n\nSendStream.prototype.hasTrailingSlash = function hasTrailingSlash () {\n  return this.path[this.path.length - 1] === '/'\n}\n\n/**\n * Check if this is a conditional GET request.\n *\n * @return {Boolean}\n * @api private\n */\n\nSendStream.prototype.isConditionalGET = function isConditionalGET () {\n  return this.req.headers['if-none-match'] ||\n    this.req.headers['if-modified-since']\n}\n\n/**\n * Strip content-* header fields.\n *\n * @private\n */\n\nSendStream.prototype.removeContentHeaderFields = function removeContentHeaderFields () {\n  var res = this.res\n  var headers = Object.keys(res._headers || {})\n\n  for (var i = 0; i < headers.length; i++) {\n    var header = headers[i]\n    if (header.substr(0, 8) === 'content-' && header !== 'content-location') {\n      res.removeHeader(header)\n    }\n  }\n}\n\n/**\n * Respond with 304 not modified.\n *\n * @api private\n */\n\nSendStream.prototype.notModified = function notModified () {\n  var res = this.res\n  debug('not modified')\n  this.removeContentHeaderFields()\n  res.statusCode = 304\n  res.end()\n}\n\n/**\n * Raise error that headers already sent.\n *\n * @api private\n */\n\nSendStream.prototype.headersAlreadySent = function headersAlreadySent () {\n  var err = new Error('Can\\'t set headers after they are sent.')\n  debug('headers already sent')\n  this.error(500, err)\n}\n\n/**\n * Check if the request is cacheable, aka\n * responded with 2xx or 304 (see RFC 2616 section 14.2{5,6}).\n *\n * @return {Boolean}\n * @api private\n */\n\nSendStream.prototype.isCachable = function isCachable () {\n  var statusCode = this.res.statusCode\n  return (statusCode >= 200 && statusCode < 300) ||\n    statusCode === 304\n}\n\n/**\n * Handle stat() error.\n *\n * @param {Error} error\n * @private\n */\n\nSendStream.prototype.onStatError = function onStatError (error) {\n  switch (error.code) {\n    case 'ENAMETOOLONG':\n    case 'ENOENT':\n    case 'ENOTDIR':\n      this.error(404, error)\n      break\n    default:\n      this.error(500, error)\n      break\n  }\n}\n\n/**\n * Check if the cache is fresh.\n *\n * @return {Boolean}\n * @api private\n */\n\nSendStream.prototype.isFresh = function isFresh () {\n  return fresh(this.req.headers, this.res._headers)\n}\n\n/**\n * Check if the range is fresh.\n *\n * @return {Boolean}\n * @api private\n */\n\nSendStream.prototype.isRangeFresh = function isRangeFresh () {\n  var ifRange = this.req.headers['if-range']\n\n  if (!ifRange) {\n    return true\n  }\n\n  return ~ifRange.indexOf('\"')\n    ? ~ifRange.indexOf(this.res._headers['etag'])\n    : Date.parse(this.res._headers['last-modified']) <= Date.parse(ifRange)\n}\n\n/**\n * Redirect to path.\n *\n * @param {string} path\n * @private\n */\n\nSendStream.prototype.redirect = function redirect (path) {\n  if (listenerCount(this, 'directory') !== 0) {\n    this.emit('directory')\n    return\n  }\n\n  if (this.hasTrailingSlash()) {\n    this.error(403)\n    return\n  }\n\n  var loc = encodeUrl(collapseLeadingSlashes(path + '/'))\n  var msg = 'Redirecting to <a href=\"' + escapeHtml(loc) + '\">' + escapeHtml(loc) + '</a>\\n'\n  var res = this.res\n\n  // redirect\n  res.statusCode = 301\n  res.setHeader('Content-Type', 'text/html; charset=UTF-8')\n  res.setHeader('Content-Length', Buffer.byteLength(msg))\n  res.setHeader('X-Content-Type-Options', 'nosniff')\n  res.setHeader('Location', loc)\n  res.end(msg)\n}\n\n/**\n * Pipe to `res.\n *\n * @param {Stream} res\n * @return {Stream} res\n * @api public\n */\n\nSendStream.prototype.pipe = function pipe (res) {\n  // root path\n  var root = this._root\n\n  // references\n  this.res = res\n\n  // decode the path\n  var path = decode(this.path)\n  if (path === -1) {\n    this.error(400)\n    return res\n  }\n\n  // null byte(s)\n  if (~path.indexOf('\\0')) {\n    this.error(400)\n    return res\n  }\n\n  var parts\n  if (root !== null) {\n    // malicious path\n    if (UP_PATH_REGEXP.test(normalize('.' + sep + path))) {\n      debug('malicious path \"%s\"', path)\n      this.error(403)\n      return res\n    }\n\n    // join / normalize from optional root dir\n    path = normalize(join(root, path))\n    root = normalize(root + sep)\n\n    // explode path parts\n    parts = path.substr(root.length).split(sep)\n  } else {\n    // \"..\" is malicious without \"root\"\n    if (UP_PATH_REGEXP.test(path)) {\n      debug('malicious path \"%s\"', path)\n      this.error(403)\n      return res\n    }\n\n    // explode path parts\n    parts = normalize(path).split(sep)\n\n    // resolve the path\n    path = resolve(path)\n  }\n\n  // dotfile handling\n  if (containsDotFile(parts)) {\n    var access = this._dotfiles\n\n    // legacy support\n    if (access === undefined) {\n      access = parts[parts.length - 1][0] === '.'\n        ? (this._hidden ? 'allow' : 'ignore')\n        : 'allow'\n    }\n\n    debug('%s dotfile \"%s\"', access, path)\n    switch (access) {\n      case 'allow':\n        break\n      case 'deny':\n        this.error(403)\n        return res\n      case 'ignore':\n      default:\n        this.error(404)\n        return res\n    }\n  }\n\n  // index file support\n  if (this._index.length && this.path[this.path.length - 1] === '/') {\n    this.sendIndex(path)\n    return res\n  }\n\n  this.sendFile(path)\n  return res\n}\n\n/**\n * Transfer `path`.\n *\n * @param {String} path\n * @api public\n */\n\nSendStream.prototype.send = function send (path, stat) {\n  var len = stat.size\n  var options = this.options\n  var opts = {}\n  var res = this.res\n  var req = this.req\n  var ranges = req.headers.range\n  var offset = options.start || 0\n\n  if (res._header) {\n    // impossible to send now\n    this.headersAlreadySent()\n    return\n  }\n\n  debug('pipe \"%s\"', path)\n\n  // set header fields\n  this.setHeader(path, stat)\n\n  // set content-type\n  this.type(path)\n\n  // conditional GET support\n  if (this.isConditionalGET() && this.isCachable() && this.isFresh()) {\n    this.notModified()\n    return\n  }\n\n  // adjust len to start/end options\n  len = Math.max(0, len - offset)\n  if (options.end !== undefined) {\n    var bytes = options.end - offset + 1\n    if (len > bytes) len = bytes\n  }\n\n  // Range support\n  if (this._acceptRanges && BYTES_RANGE_REGEXP.test(ranges)) {\n    // parse\n    ranges = parseRange(len, ranges, {\n      combine: true\n    })\n\n    // If-Range support\n    if (!this.isRangeFresh()) {\n      debug('range stale')\n      ranges = -2\n    }\n\n    // unsatisfiable\n    if (ranges === -1) {\n      debug('range unsatisfiable')\n\n      // Content-Range\n      res.setHeader('Content-Range', contentRange('bytes', len))\n\n      // 416 Requested Range Not Satisfiable\n      return this.error(416, {\n        headers: {'Content-Range': res.getHeader('Content-Range')}\n      })\n    }\n\n    // valid (syntactically invalid/multiple ranges are treated as a regular response)\n    if (ranges !== -2 && ranges.length === 1) {\n      debug('range %j', ranges)\n\n      // Content-Range\n      res.statusCode = 206\n      res.setHeader('Content-Range', contentRange('bytes', len, ranges[0]))\n\n      // adjust for requested range\n      offset += ranges[0].start\n      len = ranges[0].end - ranges[0].start + 1\n    }\n  }\n\n  // clone options\n  for (var prop in options) {\n    opts[prop] = options[prop]\n  }\n\n  // set read options\n  opts.start = offset\n  opts.end = Math.max(offset, offset + len - 1)\n\n  // content-length\n  res.setHeader('Content-Length', len)\n\n  // HEAD support\n  if (req.method === 'HEAD') {\n    res.end()\n    return\n  }\n\n  this.stream(path, opts)\n}\n\n/**\n * Transfer file for `path`.\n *\n * @param {String} path\n * @api private\n */\nSendStream.prototype.sendFile = function sendFile (path) {\n  var i = 0\n  var self = this\n\n  debug('stat \"%s\"', path)\n  fs.stat(path, function onstat (err, stat) {\n    if (err && err.code === 'ENOENT' && !extname(path) && path[path.length - 1] !== sep) {\n      // not found, check extensions\n      return next(err)\n    }\n    if (err) return self.onStatError(err)\n    if (stat.isDirectory()) return self.redirect(self.path)\n    self.emit('file', path, stat)\n    self.send(path, stat)\n  })\n\n  function next (err) {\n    if (self._extensions.length <= i) {\n      return err\n        ? self.onStatError(err)\n        : self.error(404)\n    }\n\n    var p = path + '.' + self._extensions[i++]\n\n    debug('stat \"%s\"', p)\n    fs.stat(p, function (err, stat) {\n      if (err) return next(err)\n      if (stat.isDirectory()) return next()\n      self.emit('file', p, stat)\n      self.send(p, stat)\n    })\n  }\n}\n\n/**\n * Transfer index for `path`.\n *\n * @param {String} path\n * @api private\n */\nSendStream.prototype.sendIndex = function sendIndex (path) {\n  var i = -1\n  var self = this\n\n  function next (err) {\n    if (++i >= self._index.length) {\n      if (err) return self.onStatError(err)\n      return self.error(404)\n    }\n\n    var p = join(path, self._index[i])\n\n    debug('stat \"%s\"', p)\n    fs.stat(p, function (err, stat) {\n      if (err) return next(err)\n      if (stat.isDirectory()) return next()\n      self.emit('file', p, stat)\n      self.send(p, stat)\n    })\n  }\n\n  next()\n}\n\n/**\n * Stream `path` to the response.\n *\n * @param {String} path\n * @param {Object} options\n * @api private\n */\n\nSendStream.prototype.stream = function stream (path, options) {\n  // TODO: this is all lame, refactor meeee\n  var finished = false\n  var self = this\n  var res = this.res\n\n  // pipe\n  var stream = fs.createReadStream(path, options)\n  this.emit('stream', stream)\n  stream.pipe(res)\n\n  // response finished, done with the fd\n  onFinished(res, function onfinished () {\n    finished = true\n    destroy(stream)\n  })\n\n  // error handling code-smell\n  stream.on('error', function onerror (err) {\n    // request already finished\n    if (finished) return\n\n    // clean up stream\n    finished = true\n    destroy(stream)\n\n    // error\n    self.onStatError(err)\n  })\n\n  // end\n  stream.on('end', function onend () {\n    self.emit('end')\n  })\n}\n\n/**\n * Set content-type based on `path`\n * if it hasn't been explicitly set.\n *\n * @param {String} path\n * @api private\n */\n\nSendStream.prototype.type = function type (path) {\n  var res = this.res\n\n  if (res.getHeader('Content-Type')) return\n\n  var type = mime.lookup(path)\n\n  if (!type) {\n    debug('no content-type')\n    return\n  }\n\n  var charset = mime.charsets.lookup(type)\n\n  debug('content-type %s', type)\n  res.setHeader('Content-Type', type + (charset ? '; charset=' + charset : ''))\n}\n\n/**\n * Set response header fields, most\n * fields may be pre-defined.\n *\n * @param {String} path\n * @param {Object} stat\n * @api private\n */\n\nSendStream.prototype.setHeader = function setHeader (path, stat) {\n  var res = this.res\n\n  this.emit('headers', res, path, stat)\n\n  if (this._acceptRanges && !res.getHeader('Accept-Ranges')) {\n    debug('accept ranges')\n    res.setHeader('Accept-Ranges', 'bytes')\n  }\n\n  if (this._cacheControl && !res.getHeader('Cache-Control')) {\n    var cacheControl = 'public, max-age=' + Math.floor(this._maxage / 1000)\n    debug('cache-control %s', cacheControl)\n    res.setHeader('Cache-Control', cacheControl)\n  }\n\n  if (this._lastModified && !res.getHeader('Last-Modified')) {\n    var modified = stat.mtime.toUTCString()\n    debug('modified %s', modified)\n    res.setHeader('Last-Modified', modified)\n  }\n\n  if (this._etag && !res.getHeader('ETag')) {\n    var val = etag(stat)\n    debug('etag %s', val)\n    res.setHeader('ETag', val)\n  }\n}\n\n/**\n * Clear all headers from a response.\n *\n * @param {object} res\n * @private\n */\n\nfunction clearHeaders (res) {\n  res._headers = {}\n  res._headerNames = {}\n}\n\n/**\n * Collapse all leading slashes into a single slash\n *\n * @param {string} str\n * @private\n */\nfunction collapseLeadingSlashes (str) {\n  for (var i = 0; i < str.length; i++) {\n    if (str[i] !== '/') {\n      break\n    }\n  }\n\n  return i > 1\n    ? '/' + str.substr(i)\n    : str\n}\n\n/**\n * Determine if path parts contain a dotfile.\n *\n * @api private\n */\n\nfunction containsDotFile (parts) {\n  for (var i = 0; i < parts.length; i++) {\n    if (parts[i][0] === '.') {\n      return true\n    }\n  }\n\n  return false\n}\n\n/**\n * Create a Content-Range header.\n *\n * @param {string} type\n * @param {number} size\n * @param {array} [range]\n */\n\nfunction contentRange (type, size, range) {\n  return type + ' ' + (range ? range.start + '-' + range.end : '*') + '/' + size\n}\n\n/**\n * decodeURIComponent.\n *\n * Allows V8 to only deoptimize this fn instead of all\n * of send().\n *\n * @param {String} path\n * @api private\n */\n\nfunction decode (path) {\n  try {\n    return decodeURIComponent(path)\n  } catch (err) {\n    return -1\n  }\n}\n\n/**\n * Normalize the index option into an array.\n *\n * @param {boolean|string|array} val\n * @param {string} name\n * @private\n */\n\nfunction normalizeList (val, name) {\n  var list = [].concat(val || [])\n\n  for (var i = 0; i < list.length; i++) {\n    if (typeof list[i] !== 'string') {\n      throw new TypeError(name + ' must be array of strings or false')\n    }\n  }\n\n  return list\n}\n\n/**\n * Set an object of headers on a response.\n *\n * @param {object} res\n * @param {object} headers\n * @private\n */\n\nfunction setHeaders (res, headers) {\n  var keys = Object.keys(headers)\n\n  for (var i = 0; i < keys.length; i++) {\n    var key = keys[i]\n    res.setHeader(key, headers[key])\n  }\n}\n"]}