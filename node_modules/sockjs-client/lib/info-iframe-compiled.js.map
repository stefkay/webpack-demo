{"version":3,"sources":["info-iframe.js"],"names":[],"mappings":"AAAA;;AAEA,IAAI,eAAe,QAAQ,QAAR,EAAkB,YAArC;AAAA,IACI,WAAW,QAAQ,UAAR,CADf;AAAA,IAEI,QAAQ,QAAQ,OAAR,CAFZ;AAAA,IAGI,QAAQ,QAAQ,eAAR,CAHZ;AAAA,IAII,kBAAkB,QAAQ,oBAAR,CAJtB;AAAA,IAKI,qBAAqB,QAAQ,wBAAR,CALzB;;AAQA,IAAI,QAAQ,YAAW,CAAE,CAAzB;AACA,IAAI,QAAQ,GAAR,CAAY,QAAZ,KAAyB,YAA7B,EAA2C;AACzC,UAAQ,QAAQ,OAAR,EAAiB,2BAAjB,CAAR;AACD;;AAED,SAAS,UAAT,CAAoB,OAApB,EAA6B,GAA7B,EAAkC;AAChC,MAAI,OAAO,IAAX;AACA,eAAa,IAAb,CAAkB,IAAlB;;AAEA,MAAI,KAAK,YAAW;AAClB,QAAI,MAAM,KAAK,GAAL,GAAW,IAAI,eAAJ,CAAoB,mBAAmB,aAAvC,EAAsD,GAAtD,EAA2D,OAA3D,CAArB;;AAEA,QAAI,IAAJ,CAAS,SAAT,EAAoB,UAAS,GAAT,EAAc;AAChC,UAAI,GAAJ,EAAS;AACP,YAAI,CAAJ;AACA,YAAI;AACF,cAAI,MAAM,KAAN,CAAY,GAAZ,CAAJ;AACD,SAFD,CAEE,OAAO,CAAP,EAAU;AACV,gBAAM,UAAN,EAAkB,GAAlB;AACA,eAAK,IAAL,CAAU,QAAV;AACA,eAAK,KAAL;AACA;AACD;;AAED,YAAI,OAAO,EAAE,CAAF,CAAX;AAAA,YAAiB,MAAM,EAAE,CAAF,CAAvB;AACA,aAAK,IAAL,CAAU,QAAV,EAAoB,IAApB,EAA0B,GAA1B;AACD;AACD,WAAK,KAAL;AACD,KAhBD;;AAkBA,QAAI,IAAJ,CAAS,OAAT,EAAkB,YAAW;AAC3B,WAAK,IAAL,CAAU,QAAV;AACA,WAAK,KAAL;AACD,KAHD;AAID,GAzBD;;AA2BA;AACA,MAAI,CAAC,OAAO,QAAP,CAAgB,IAArB,EAA2B;AACzB,UAAM,WAAN,CAAkB,MAAlB,EAA0B,EAA1B;AACD,GAFD,MAEO;AACL;AACD;AACF;;AAED,SAAS,UAAT,EAAqB,YAArB;;AAEA,WAAW,OAAX,GAAqB,YAAW;AAC9B,SAAO,gBAAgB,OAAhB,EAAP;AACD,CAFD;;AAIA,WAAW,SAAX,CAAqB,KAArB,GAA6B,YAAW;AACtC,MAAI,KAAK,GAAT,EAAc;AACZ,SAAK,GAAL,CAAS,KAAT;AACD;AACD,OAAK,kBAAL;AACA,OAAK,GAAL,GAAW,IAAX;AACD,CAND;;AAQA,OAAO,OAAP,GAAiB,UAAjB","file":"info-iframe-compiled.js","sourcesContent":["'use strict';\n\nvar EventEmitter = require('events').EventEmitter\n  , inherits = require('inherits')\n  , JSON3 = require('json3')\n  , utils = require('./utils/event')\n  , IframeTransport = require('./transport/iframe')\n  , InfoReceiverIframe = require('./info-iframe-receiver')\n  ;\n\nvar debug = function() {};\nif (process.env.NODE_ENV !== 'production') {\n  debug = require('debug')('sockjs-client:info-iframe');\n}\n\nfunction InfoIframe(baseUrl, url) {\n  var self = this;\n  EventEmitter.call(this);\n\n  var go = function() {\n    var ifr = self.ifr = new IframeTransport(InfoReceiverIframe.transportName, url, baseUrl);\n\n    ifr.once('message', function(msg) {\n      if (msg) {\n        var d;\n        try {\n          d = JSON3.parse(msg);\n        } catch (e) {\n          debug('bad json', msg);\n          self.emit('finish');\n          self.close();\n          return;\n        }\n\n        var info = d[0], rtt = d[1];\n        self.emit('finish', info, rtt);\n      }\n      self.close();\n    });\n\n    ifr.once('close', function() {\n      self.emit('finish');\n      self.close();\n    });\n  };\n\n  // TODO this seems the same as the 'needBody' from transports\n  if (!global.document.body) {\n    utils.attachEvent('load', go);\n  } else {\n    go();\n  }\n}\n\ninherits(InfoIframe, EventEmitter);\n\nInfoIframe.enabled = function() {\n  return IframeTransport.enabled();\n};\n\nInfoIframe.prototype.close = function() {\n  if (this.ifr) {\n    this.ifr.close();\n  }\n  this.removeAllListeners();\n  this.ifr = null;\n};\n\nmodule.exports = InfoIframe;\n"]}