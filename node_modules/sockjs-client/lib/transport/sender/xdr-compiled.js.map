{"version":3,"sources":["xdr.js"],"names":[],"mappings":"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","file":"xdr-compiled.js","sourcesContent":["'use strict';\n\nvar EventEmitter = require('events').EventEmitter\n  , inherits = require('inherits')\n  , eventUtils = require('../../utils/event')\n  , browser = require('../../utils/browser')\n  , urlUtils = require('../../utils/url')\n  ;\n\nvar debug = function() {};\nif (process.env.NODE_ENV !== 'production') {\n  debug = require('debug')('sockjs-client:sender:xdr');\n}\n\n// References:\n//   http://ajaxian.com/archives/100-line-ajax-wrapper\n//   http://msdn.microsoft.com/en-us/library/cc288060(v=VS.85).aspx\n\nfunction XDRObject(method, url, payload) {\n  debug(method, url);\n  var self = this;\n  EventEmitter.call(this);\n\n  setTimeout(function() {\n    self._start(method, url, payload);\n  }, 0);\n}\n\ninherits(XDRObject, EventEmitter);\n\nXDRObject.prototype._start = function(method, url, payload) {\n  debug('_start');\n  var self = this;\n  var xdr = new global.XDomainRequest();\n  // IE caches even POSTs\n  url = urlUtils.addQuery(url, 't=' + (+new Date()));\n\n  xdr.onerror = function() {\n    debug('onerror');\n    self._error();\n  };\n  xdr.ontimeout = function() {\n    debug('ontimeout');\n    self._error();\n  };\n  xdr.onprogress = function() {\n    debug('progress', xdr.responseText);\n    self.emit('chunk', 200, xdr.responseText);\n  };\n  xdr.onload = function() {\n    debug('load');\n    self.emit('finish', 200, xdr.responseText);\n    self._cleanup(false);\n  };\n  this.xdr = xdr;\n  this.unloadRef = eventUtils.unloadAdd(function() {\n    self._cleanup(true);\n  });\n  try {\n    // Fails with AccessDenied if port number is bogus\n    this.xdr.open(method, url);\n    if (this.timeout) {\n      this.xdr.timeout = this.timeout;\n    }\n    this.xdr.send(payload);\n  } catch (x) {\n    this._error();\n  }\n};\n\nXDRObject.prototype._error = function() {\n  this.emit('finish', 0, '');\n  this._cleanup(false);\n};\n\nXDRObject.prototype._cleanup = function(abort) {\n  debug('cleanup', abort);\n  if (!this.xdr) {\n    return;\n  }\n  this.removeAllListeners();\n  eventUtils.unloadDel(this.unloadRef);\n\n  this.xdr.ontimeout = this.xdr.onerror = this.xdr.onprogress = this.xdr.onload = null;\n  if (abort) {\n    try {\n      this.xdr.abort();\n    } catch (x) {\n      // intentionally empty\n    }\n  }\n  this.unloadRef = this.xdr = null;\n};\n\nXDRObject.prototype.close = function() {\n  debug('close');\n  this._cleanup(true);\n};\n\n// IE 8/9 if the request target uses the same scheme - #79\nXDRObject.enabled = !!(global.XDomainRequest && browser.hasDomain());\n\nmodule.exports = XDRObject;\n"]}