{"version":3,"sources":["sockjs_app.js"],"names":[],"mappings":"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","file":"sockjs_app-compiled.js","sourcesContent":["var sockjs = require('../../index');\n\nexports.install = function(opts, server) {\n    var sjs_echo = sockjs.createServer(opts);\n    sjs_echo.on('connection', function(conn) {\n        console.log('    [+] echo open    ' + conn);\n        conn.on('close', function() {\n            console.log('    [-] echo close   ' + conn);\n        });\n        conn.on('data', function(m) {\n            var d  = JSON.stringify(m);\n            console.log('    [ ] echo message ' + conn,\n                        d.slice(0,64)+\n                        ((d.length > 64) ? '...' : ''));\n            conn.write(m);\n        });\n    });\n\n    var sjs_close = sockjs.createServer(opts);\n    sjs_close.on('connection', function(conn) {\n        console.log('    [+] clos open    ' + conn);\n        conn.close(3000, \"Go away!\");\n        conn.on('close', function() {\n            console.log('    [-] clos close   ' + conn);\n        });\n    });\n\n    var sjs_ticker = sockjs.createServer(opts);\n    sjs_ticker.on('connection', function(conn) {\n        console.log('    [+] ticker open   ' + conn);\n        var tref;\n        var schedule = function() {\n            conn.write('tick!');\n            tref = setTimeout(schedule, 1000);\n        };\n        tref = setTimeout(schedule, 1000);\n        conn.on('close', function() {\n            clearTimeout(tref);\n            console.log('    [-] ticker close   ' + conn);\n        });\n    });\n\n    var broadcast = {};\n    var sjs_broadcast = sockjs.createServer(opts);\n    sjs_broadcast.on('connection', function(conn) {\n        console.log('    [+] broadcast open ' + conn);\n        broadcast[conn.id] = conn;\n        conn.on('close', function() {\n            delete broadcast[conn.id];\n            console.log('    [-] broadcast close' + conn);\n        });\n        conn.on('data', function(m) {\n            console.log('    [-] broadcast message', m);\n            for(var id in broadcast) {\n                broadcast[id].write(m);\n            }\n        });\n    });\n\n    var sjs_amplify = sockjs.createServer(opts);\n    sjs_amplify.on('connection', function(conn) {\n        console.log('    [+] amp open    ' + conn);\n        conn.on('close', function() {\n            console.log('    [-] amp close   ' + conn);\n        });\n        conn.on('data', function(m) {\n            var n = Math.floor(Number(m));\n            n = (n > 0 && n < 19) ? n : 1;\n            console.log('    [ ] amp message: 2^' + n);\n            conn.write(Array(Math.pow(2, n)+1).join('x'));\n        });\n    });\n\n\n    sjs_echo.installHandlers(server, {prefix:'/echo',\n                                      response_limit: 4096}),\n    sjs_echo.installHandlers(server, {prefix:'/disabled_websocket_echo',\n                                      websocket: false});\n    sjs_echo.installHandlers(server, {prefix:'/cookie_needed_echo',\n                                      jsessionid: true});\n    sjs_close.installHandlers(server, {prefix:'/close'});\n    sjs_ticker.installHandlers(server, {prefix:'/ticker'});\n    sjs_amplify.installHandlers(server, {prefix:'/amplify'});\n    sjs_broadcast.installHandlers(server, {prefix:'/broadcast'});\n};\n"]}