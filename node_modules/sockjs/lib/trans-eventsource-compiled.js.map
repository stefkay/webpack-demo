{"version":3,"sources":["trans-eventsource.js"],"names":[],"mappings":"AAAA;AACA,CAAC,YAAW;AACV,MAAI,mBAAJ;AAAA,MAAyB,SAAzB;AAAA,MAAoC,KAApC;AAAA,MACE,SAAS,UAAS,KAAT,EAAgB,MAAhB,EAAwB;AAAE,SAAK,IAAI,GAAT,IAAgB,MAAhB,EAAwB;AAAE,UAAI,QAAQ,IAAR,CAAa,MAAb,EAAqB,GAArB,CAAJ,EAA+B,MAAM,GAAN,IAAa,OAAO,GAAP,CAAb;AAA2B,KAAC,SAAS,IAAT,GAAgB;AAAE,WAAK,WAAL,GAAmB,KAAnB;AAA2B,KAAC,KAAK,SAAL,GAAiB,OAAO,SAAxB,CAAmC,MAAM,SAAN,GAAkB,IAAI,IAAJ,EAAlB,CAA8B,MAAM,SAAN,GAAkB,OAAO,SAAzB,CAAoC,OAAO,KAAP;AAAe,GAD5R;AAAA,MAEE,UAAU,GAAG,cAFf;;AAIA,UAAQ,QAAQ,SAAR,CAAR;;AAEA,cAAY,QAAQ,aAAR,CAAZ;;AAEA,wBAAuB,UAAS,UAAT,EAAqB;AAC1C,WAAO,mBAAP,EAA4B,UAA5B;;AAEA,aAAS,mBAAT,GAA+B;AAC7B,aAAO,oBAAoB,SAApB,CAA8B,WAA9B,CAA0C,KAA1C,CAAgD,IAAhD,EAAsD,SAAtD,CAAP;AACD;;AAED,wBAAoB,SAApB,CAA8B,QAA9B,GAAyC,aAAzC;;AAEA,wBAAoB,SAApB,CAA8B,WAA9B,GAA4C,UAAS,OAAT,EAAkB;AAC5D,UAAI,IAAJ;AACA,aAAO,CAAC,QAAD,EAAW,MAAM,eAAN,CAAsB,OAAtB,EAA+B,UAA/B,CAAX,EAAuD,UAAvD,CAAP;AACA,aAAO,oBAAoB,SAApB,CAA8B,WAA9B,CAA0C,IAA1C,CAA+C,IAA/C,EAAqD,KAAK,IAAL,CAAU,EAAV,CAArD,CAAP;AACD,KAJD;;AAMA,WAAO,mBAAP;AAED,GAjBqB,CAiBnB,UAAU,gBAjBS,CAAtB;;AAmBA,UAAQ,GAAR,GAAc;AACZ,iBAAa,UAAS,GAAT,EAAc,GAAd,EAAmB;AAC9B,UAAI,OAAJ,EAAa,MAAb;AACA,UAAI,CAAC,IAAI,OAAJ,CAAY,QAAZ,CAAD,IAA0B,IAAI,OAAJ,CAAY,QAAZ,MAA0B,MAAxD,EAAgE;AAC9D,iBAAS,GAAT;AACD,OAFD,MAEO;AACL,iBAAS,IAAI,OAAJ,CAAY,QAAZ,CAAT;AACA,YAAI,SAAJ,CAAc,kCAAd,EAAkD,MAAlD;AACD;AACD,UAAI,SAAJ,CAAc,cAAd,EAA8B,mBAA9B;AACA,UAAI,SAAJ,CAAc,6BAAd,EAA6C,MAA7C;AACA,UAAI,SAAJ,CAAc,MAAd,EAAsB,QAAtB;AACA,gBAAU,IAAI,OAAJ,CAAY,gCAAZ,CAAV;AACA,UAAI,OAAJ,EAAa;AACX,YAAI,SAAJ,CAAc,8BAAd,EAA8C,OAA9C;AACD;AACD,UAAI,SAAJ,CAAc,GAAd;AACA,UAAI,KAAJ,CAAU,MAAV;AACA,gBAAU,QAAV,CAAmB,GAAnB,EAAwB,IAAxB,EAA8B,IAAI,mBAAJ,CAAwB,GAAxB,EAA6B,GAA7B,EAAkC,KAAK,OAAvC,CAA9B;AACA,aAAO,IAAP;AACD;AApBW,GAAd;AAuBD,CAnDD,EAmDG,IAnDH,CAmDQ,IAnDR","file":"trans-eventsource-compiled.js","sourcesContent":["// Generated by CoffeeScript 1.9.3\n(function() {\n  var EventSourceReceiver, transport, utils,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  utils = require('./utils');\n\n  transport = require('./transport');\n\n  EventSourceReceiver = (function(superClass) {\n    extend(EventSourceReceiver, superClass);\n\n    function EventSourceReceiver() {\n      return EventSourceReceiver.__super__.constructor.apply(this, arguments);\n    }\n\n    EventSourceReceiver.prototype.protocol = \"eventsource\";\n\n    EventSourceReceiver.prototype.doSendFrame = function(payload) {\n      var data;\n      data = ['data: ', utils.escape_selected(payload, '\\r\\n\\x00'), '\\r\\n\\r\\n'];\n      return EventSourceReceiver.__super__.doSendFrame.call(this, data.join(''));\n    };\n\n    return EventSourceReceiver;\n\n  })(transport.ResponseReceiver);\n\n  exports.app = {\n    eventsource: function(req, res) {\n      var headers, origin;\n      if (!req.headers['origin'] || req.headers['origin'] === 'null') {\n        origin = '*';\n      } else {\n        origin = req.headers['origin'];\n        res.setHeader('Access-Control-Allow-Credentials', 'true');\n      }\n      res.setHeader('Content-Type', 'text/event-stream');\n      res.setHeader('Access-Control-Allow-Origin', origin);\n      res.setHeader('Vary', 'Origin');\n      headers = req.headers['access-control-request-headers'];\n      if (headers) {\n        res.setHeader('Access-Control-Allow-Headers', headers);\n      }\n      res.writeHead(200);\n      res.write('\\r\\n');\n      transport.register(req, this, new EventSourceReceiver(req, res, this.options));\n      return true;\n    }\n  };\n\n}).call(this);\n"]}