{"version":3,"sources":["pledge.js"],"names":[],"mappings":"AAAA;;AAEA,IAAI,aAAa,QAAQ,eAAR,CAAjB;;AAEA,IAAI,SAAS,YAAW;AACtB,OAAK,SAAL,GAAkB,KAAlB;AACA,OAAK,UAAL,GAAkB,IAAI,UAAJ,CAAe,OAAO,UAAtB,CAAlB;AACD,CAHD;;AAKA,OAAO,UAAP,GAAoB,CAApB;;AAEA,OAAO,GAAP,GAAa,UAAS,IAAT,EAAe;AAC1B,MAAI,SAAU,IAAI,MAAJ,EAAd;AAAA,MACI,UAAU,KAAK,MADnB;AAAA,MAEI,IAAU,OAFd;;AAIA,MAAI,YAAY,CAAhB,EAAmB,OAAO,IAAP;;AAEnB,SAAO,GAAP,EAAY,KAAK,CAAL,EAAQ,IAAR,CAAa,YAAW;AAClC,eAAW,CAAX;AACA,QAAI,YAAY,CAAhB,EAAmB,OAAO,IAAP;AACpB,GAHW;AAIZ,SAAO,MAAP;AACD,CAZD;;AAcA,OAAO,SAAP,CAAiB,IAAjB,GAAwB,UAAS,QAAT,EAAmB;AACzC,MAAI,KAAK,SAAT,EAAoB,WAApB,KACK,KAAK,UAAL,CAAgB,IAAhB,CAAqB,QAArB;AACN,CAHD;;AAKA,OAAO,SAAP,CAAiB,IAAjB,GAAwB,YAAW;AACjC,OAAK,SAAL,GAAiB,IAAjB;AACA,MAAI,YAAY,KAAK,UAArB;AAAA,MAAiC,QAAjC;AACA,SAAO,WAAW,UAAU,KAAV,EAAlB,EAAqC;AACtC,CAJD;;AAMA,OAAO,OAAP,GAAiB,MAAjB","file":"pledge-compiled.js","sourcesContent":["'use strict';\n\nvar RingBuffer = require('./ring_buffer');\n\nvar Pledge = function() {\n  this._complete  = false;\n  this._callbacks = new RingBuffer(Pledge.QUEUE_SIZE);\n};\n\nPledge.QUEUE_SIZE = 4;\n\nPledge.all = function(list) {\n  var pledge  = new Pledge(),\n      pending = list.length,\n      n       = pending;\n\n  if (pending === 0) pledge.done();\n\n  while (n--) list[n].then(function() {\n    pending -= 1;\n    if (pending === 0) pledge.done();\n  });\n  return pledge;\n};\n\nPledge.prototype.then = function(callback) {\n  if (this._complete) callback();\n  else this._callbacks.push(callback);\n};\n\nPledge.prototype.done = function() {\n  this._complete = true;\n  var callbacks = this._callbacks, callback;\n  while (callback = callbacks.shift()) callback();\n};\n\nmodule.exports = Pledge;\n"]}